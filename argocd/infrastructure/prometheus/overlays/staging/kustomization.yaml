# ============================================
# KUSTOMIZE OVERLAY - STAGING ENVIRONMENT
# ============================================
# Pattern: Kustomize Overlays for multi-environment
# Docs: https://kubectl.docs.kubernetes.io/references/kustomize/kustomization/patches/
# Patch Format: JSON Patch (RFC 6902) - https://tools.ietf.org/html/rfc6902
# ============================================

apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: argocd

resources:
  - ../../base

patches:
  - target:
      kind: Application
      name: prometheus
    patch: |-
      - op: replace
        path: /metadata/name
        value: prometheus-staging
      - op: add
        path: /metadata/labels
        value:
          environment: staging
      - op: replace
        path: /spec/sources/0/helm/valueFiles/0
        value: $values/argocd/config/prometheus/staging-values.yaml
