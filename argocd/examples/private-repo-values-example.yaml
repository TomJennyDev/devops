# ==============================================================================
# Giải pháp đơn giản: Private Git Repository cho Values
# ==============================================================================
#
# Structure:
# ├── devops/ (public repo)
# │   └── argocd/
# │       └── system-apps/
# │           └── aws-load-balancer-controller.yaml (không có values)
# │
# └── devops-private/ (private repo)
#     └── values/
#         ├── dev/
#         │   └── alb-controller-values.yaml
#         ├── staging/
#         │   └── alb-controller-values.yaml
#         └── prod/
#             └── alb-controller-values.yaml
#
# ==============================================================================

---
# File trong public repo (argocd/system-apps/aws-load-balancer-controller.yaml)
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: aws-load-balancer-controller
  namespace: argocd
spec:
  project: default
  
  sources:
    # Source 1: Helm Chart
    - repoURL: https://aws.github.io/eks-charts
      chart: aws-load-balancer-controller
      targetRevision: 1.8.2
      helm:
        releaseName: aws-load-balancer-controller
        # Không có values ở đây
    
    # Source 2: Values từ private repo
    - repoURL: https://github.com/TomJennyDev/devops-private.git
      targetRevision: main
      ref: values
      helm:
        valueFiles:
          - $values/values/dev/alb-controller-values.yaml  # Private values
  
  destination:
    server: https://kubernetes.default.svc
    namespace: kube-system
  
  syncPolicy:
    automated:
      prune: true
      selfHeal: true

---
# File trong private repo (values/dev/alb-controller-values.yaml)
# Chứa tất cả sensitive data
clusterName: my-eks-dev
vpcId: vpc-0e6ca42c7851c46c4
region: ap-southeast-1

serviceAccount:
  create: true
  annotations:
    eks.amazonaws.com/role-arn: arn:aws:iam::372836560690:role/my-eks-dev-aws-load-balancer-controller

resources:
  limits:
    cpu: 200m
    memory: 500Mi
  requests:
    cpu: 100m
    memory: 200Mi

replicaCount: 2

---
# Setup credentials cho private repo:
# kubectl create secret generic devops-private-repo \
#   -n argocd \
#   --from-literal=type=git \
#   --from-literal=url=https://github.com/TomJennyDev/devops-private.git \
#   --from-literal=password=ghp_YourPersonalAccessToken \
#   --from-literal=username=TomJennyDev
# 
# kubectl label secret devops-private-repo \
#   -n argocd \
#   argocd.argoproj.io/secret-type=repository
