# Prometheus Helm Values - Reference Guide

## üì¶ Official Sources

All files in this directory are based on **official Prometheus Community Helm Chart**:

- **Chart Repository**: <https://github.com/prometheus-community/helm-charts>
- **Chart Name**: `kube-prometheus-stack`
- **Chart Version**: `65.2.0`
- **Helm Repo URL**: <https://prometheus-community.github.io/helm-charts>
- **ArtifactHub**: <https://artifacthub.io/packages/helm/prometheus-community/kube-prometheus-stack>
- **License**: Apache 2.0
- **Maintained by**: Prometheus Community

### Official Documentation

- **Prometheus**: <https://prometheus.io/docs/>
- **Grafana**: <https://grafana.com/docs/grafana/latest/>
- **AlertManager**: <https://prometheus.io/docs/alerting/latest/alertmanager/>
- **Prometheus Operator**: <https://prometheus-operator.dev/>
- **Node Exporter**: <https://github.com/prometheus/node_exporter>
- **Kube State Metrics**: <https://github.com/kubernetes/kube-state-metrics>

## üìÅ Files trong th∆∞ m·ª•c n√†y

### 1. **default-values-reference.yaml** (5413 d√≤ng)

- **Source**: Official Helm chart `prometheus-community/kube-prometheus-stack` v65.2.0
- **Generated by**: `helm show values prometheus-community/kube-prometheus-stack`
- **Purpose**: Reference ƒë·∫ßy ƒë·ªß ALL possible options with official comments
- **Official Source**: <https://github.com/prometheus-community/helm-charts/blob/main/charts/kube-prometheus-stack/values.yaml>
- **Usage**: T√¨m ki·∫øm options b·∫°n c·∫ßn, sau ƒë√≥ copy v√†o dev/staging/prod values
- **Last Updated**: 2025-11-25

### 2. **dev-values.yaml** (Custom - Based on Official Chart)

- **Base**: kube-prometheus-stack v65.2.0 defaults
- **Customization Level**: Minimal - only overrides for Dev environment
- Override cho Dev environment
- Ch·ªâ ch·ª©a settings kh√°c v·ªõi default
- Optimized cho cost (low resources, short retention)
- **Verified Against**: default-values-reference.yaml

### 3. **staging-values.yaml** (Custom)

- Override cho Staging environment
- Medium resources, HA v·ªõi 2 replicas

### 4. **prod-values.yaml** (Custom)

- Override cho Production environment
- High resources, full HA v·ªõi 3 replicas, anti-affinity

## üîç C√°ch s·ª≠ d·ª•ng default-values-reference.yaml

### T√¨m ki·∫øm option b·∫°n c·∫ßn

```bash
# T√¨m retention settings
grep -n "retention" default-values-reference.yaml

# T√¨m storage settings
grep -n "storage" default-values-reference.yaml

# T√¨m Grafana settings
grep -n "grafana:" default-values-reference.yaml

# T√¨m ingress settings
grep -n "ingress:" default-values-reference.yaml
```

### Copy v√†o custom values

1. T√¨m section b·∫°n c·∫ßn trong `default-values-reference.yaml`
2. Copy structure v√†o `dev-values.yaml` / `staging-values.yaml` / `prod-values.yaml`
3. Ch·ªâ override values kh√°c v·ªõi default
4. Th√™m comments gi·∫£i th√≠ch t·∫°i sao override

## üìñ C·∫•u tr√∫c ch√≠nh trong default-values-reference.yaml

```yaml
# Line ~1-100: Global settings
nameOverride, namespaceOverride, commonLabels

# Line ~100-500: CRDs & Prometheus Operator
prometheusOperator:
  resources, replicas, nodeSelector, tolerations

# Line ~500-2500: Prometheus Server
prometheus:
  prometheusSpec:
    retention, retentionSize
    resources, replicas
    storageSpec
    scrapeInterval, evaluationInterval
    serviceMonitorSelector
    ruleSelector
    alertingEndpoints
    remoteWrite, remoteRead
    affinity, tolerations

# Line ~2500-3500: Grafana
grafana:
  enabled
  adminPassword
  resources, replicas
  persistence
  ingress
  datasources
  dashboardProviders
  dashboards
  grafana.ini

# Line ~3500-4000: AlertManager
alertmanager:
  enabled
  alertmanagerSpec:
    resources, replicas
    storage
    config  # routing, receivers

# Line ~4000-4500: Other exporters
nodeExporter:
  enabled, resources
kubeStateMetrics:
  enabled, resources
prometheusNodeExporter:
  enabled, resources

# Line ~4500-5413: Service Monitors & Rules
defaultRules:
  create, rules (c√°c rule groups)
```

## üí° Best Practices

### ‚úÖ DO

- Tham kh·∫£o `default-values-reference.yaml` ƒë·ªÉ bi·∫øt options c√≥ s·∫µn
- Ch·ªâ override nh·ªØng g√¨ c·∫ßn thi·∫øt trong custom values
- Th√™m comments gi·∫£i th√≠ch WHY override
- Test v·ªõi `helm template` tr∆∞·ªõc khi deploy

### ‚ùå DON'T

- Kh√¥ng copy to√†n b·ªô 5413 d√≤ng v√†o custom values
- Kh√¥ng hardcode passwords trong Git (d√πng Sealed Secrets)
- Kh√¥ng set resources qu√° th·∫•p (Prometheus c·∫ßn RAM)

## üéØ Examples

### T√¨m v√† override Grafana ingress

```bash
# 1. T√¨m trong reference
grep -A 20 "grafana:" default-values-reference.yaml | grep -A 10 "ingress:"

# 2. Copy structure v√† override
```

```yaml
# prod-values.yaml
grafana:
  ingress:
    enabled: true
    ingressClassName: alb
    annotations:
      alb.ingress.kubernetes.io/scheme: internet-facing
      alb.ingress.kubernetes.io/certificate-arn: "arn:aws:acm:..."
    hosts:
      - grafana.example.com
```

### T√¨m v√† override Prometheus remote write

```bash
grep -A 30 "remoteWrite:" default-values-reference.yaml
```

```yaml
# prod-values.yaml
prometheus:
  prometheusSpec:
    remoteWrite:
      - url: https://prometheus-remote.example.com/write
        basicAuth:
          username:
            name: remote-write-creds
            key: username
          password:
            name: remote-write-creds
            key: password
```

## üìö Official Documentation

- **Chart Repository**: <https://github.com/prometheus-community/helm-charts>
- **Chart Hub**: <https://artifacthub.io/packages/helm/prometheus-community/kube-prometheus-stack>
- **Prometheus Docs**: <https://prometheus.io/docs/>
- **Grafana Docs**: <https://grafana.com/docs/>

## üîÑ Update Reference File

```bash
# Khi c√≥ version m·ªõi c·ªßa chart
helm repo update
helm show values prometheus-community/kube-prometheus-stack > default-values-reference.yaml

# Check version
helm search repo prometheus-community/kube-prometheus-stack
```

## üìù Notes

- File `default-values-reference.yaml` l√† **READ-ONLY reference**
- Kh√¥ng ƒë∆∞·ª£c deploy tr·ª±c ti·∫øp file n√†y
- Lu√¥n t·∫°o custom values ri√™ng cho t·ª´ng environment
- Keep custom values minimal (ch·ªâ override c·∫ßn thi·∫øt)
