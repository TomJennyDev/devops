apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

# Reference base configuration
bases:
  - ../../base

# Namespace for dev environment
namespace: flowise-dev

# Common labels for dev
commonLabels:
  environment: dev

# Additional resources for dev
resources:
  - ingress.yaml

# Patches specific to dev environment
patchesStrategicMerge:
  - deployment-patch.yaml

# Images will be updated by GitHub Actions
# kustomize edit set image flowise-server=...
# kustomize edit set image flowise-ui=...
images:
  - name: flowise-server
    newName: 372836560690.dkr.ecr.ap-southeast-1.amazonaws.com/flowise-server
    newTag: latest
  - name: flowise-ui
    newName: 372836560690.dkr.ecr.ap-southeast-1.amazonaws.com/flowise-ui
    newTag: latest

# ConfigMap generator for dev-specific config
configMapGenerator:
  - name: flowise-env
    literals:
      - ENVIRONMENT=dev
      - LOG_LEVEL=debug
      - DEBUG=true

# Secret generator for dev (use sealed-secrets or external-secrets in production)
secretGenerator:
  - name: flowise-secrets
    literals:
      - database-host=postgres.flowise-dev.svc.cluster.local
      - database-user=flowise_dev
      - database-password=dev-password-123  # ⚠️ Use secrets manager in production
